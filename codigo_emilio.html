<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor Código Emilio</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
            background-color: #292A2D;
            color: #e0e0e0;
            position: relative;
        }
        
        .app-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        
        .logout-btn {
            background: #c62828;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-btn:hover {
            background: #b71c1c;
            transform: translateY(-1px);
        }
        
        .calculator {
            background-color: #212327;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgb(61, 61, 61);
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo {
            width: 300px;
            height: auto;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .logo:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        
        .logo-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #4166d5, transparent);
            margin: 0 auto 25px auto;
            width: 90%;
            box-shadow: 0 2px 5px rgba(65, 102, 213, 0.3);
        }
        
        h2 {
            color: #4d6aff;
            margin-bottom: 25px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-align: center;
        }
        
        .config-selector {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        
        .conversion-type {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .conversion-type label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #ffffff;
            font-size: 15px;
        }
        
        input, select, textarea {
            padding: 12px;
            width: 100%;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #2d2d2d;
            color: #fff;
            font-size: 16px;
            transition: border 0.3s;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #4166d5;
            outline: none;
        }
        
        button {
            background: linear-gradient(to bottom, #243fc8, #2f51ff);
            color: #ffffff;
            border: none;
            padding: 14px;
            width: 100%;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #4166d5, #4166d5);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 25px;
            padding: 20px;
            background-color: #252525;
            border-radius: 8px;
            display: none;
            border-left: 4px solid #4166d5;
        }
        
        .error {
            color: #ffcdd2;
            margin-top: 20px;
            padding: 12px;
            background-color: #c62828;
            border-radius: 6px;
            display: none;
            font-size: 15px;
        }
        
        .conversion-value {
            font-size: 22px;
            color: #4166d5;
            font-weight: bold;
            margin: 10px 0;
            word-break: break-all;
        }
        
        hr {
            border: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #4166d5, transparent);
            margin: 18px 0;
        }
        
        .conversion-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        
        .conversion-item:last-child {
            border-bottom: none;
        }
        
        .formula {
            font-family: 'Courier New', monospace;
            background-color: #2d2d2d;
            padding: 8px 12px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .copy-btn {
            background: #4166d5;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            background: #3a5bc0;
        }
        .session-header {
    position: absolute;
    top: 20px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.logout-btn {
    background: #c62828;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
}

.logout-btn:hover {
    background: #b71c1c;
    transform: translateY(-1px);
}

.session-header {
    position: absolute;
    top: 20px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.logout-btn {
    background: #c62828;
    color: white;
    border: none;
    padding: 10px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s;
    height: auto;
    width: auto;
}

.logout-btn:hover {
    background: #b71c1c;
    transform: translateY(-1px);
}

.session-timer {
    margin: 0;
    font-weight: normal;
    font-size: 14px;
    color: #ccc;
}
.plain-hr {
    all: unset;
    display: block;
    height: 1px;
    background-color: transparent;
    margin: 10px 0;
}



    </style>
</head>
<body>
    <div class="session-box">
        <div class="session-header">
            <p class="session-timer">La sesión expirará en <span id="timer">30:00</span></p>
            <button class="logout-btn" id="logout-btn">Cerrar Sesión</button>
        </div>
    </div>
    <hr class="plain-hr">
    <hr class="plain-hr">
    <hr class="plain-hr">
    <hr class="plain-hr">
    <hr class="plain-hr">

        <div class="calculator">
        <div class="logo-container">
            <img src="img/logo.png" alt="Código Emilio Logo" class="logo" title="Código Emilio">
            <div class="logo-divider"></div>
        </div>
        
        <h2>Conversor Código Emilio</h2>
        
        <div class="config-selector">
            <label>Seleccione el tipo de conversión:</label>
            <div class="conversion-type">
                <label>
                    <input type="radio" name="conversion-type" value="encode" checked> Texto a Código
                </label>
                <label>
                    <input type="radio" name="conversion-type" value="decode"> Código a Texto
                </label>
            </div>
        </div>
        
        <!-- Conversión de Texto a Código -->
        <div class="input-group" id="encode-group">
            <label for="text-to-encode">Texto a codificar:</label>
            <textarea id="text-to-encode" placeholder="Escribe el texto que quieres convertir a Código Emilio"></textarea>
        </div>
        
        <!-- Conversión de Código a Texto -->
        <div class="input-group" id="decode-group" style="display: none;">
            <label for="code-to-decode">Código a decodificar:</label>
            <textarea id="code-to-decode" placeholder="Pega el código Emilio que quieres convertir a texto (Ejemplo: $40%84$60@6 | $65&126$70#24%84)"></textarea>
        </div>
        
        <button id="convert-btn">Convertir</button>
        
        <div class="error" id="error"></div>
        
        <div class="result" id="result" style="display: none;">
            <h3>RESULTADO:</h3>
            <hr>
            <div class="conversion-item">
                <div class="conversion-value" id="converted-result"></div>
                <button class="copy-btn" id="copy-btn">Copiar resultado</button>
            </div>
            
            <div id="code-info">
                <h4>Reglas del Código Emilio:</h4>
                <div class="formula">
                    <strong>Vocales:</strong><br>
                    A = @6, E = #30, I = $54, O = %84, U = &126<br><br>
                    <strong>Consonantes:</strong><br>
                    Grupo 1 (B-K): # + (posición × 6)<br>
                    Grupo 2 (L-T): $ + (posición × 5) [Regla Calep]<br>
                    Grupo 3 (U-Z): & + (posición × 6)<br><br>
                    <strong>Espacio:</strong> |
                </div>
            </div>
        </div>
    </div>

    <script>
// Verificar autenticación y expiración al cargar la página
const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
const expiresAt = parseInt(sessionStorage.getItem('expiresAt'), 10);
const now = Date.now();

if (!isAuthenticated || isNaN(expiresAt) || now > expiresAt) {
    sessionStorage.clear(); // Limpiar por seguridad
    window.location.href = 'login.html'; // Cambia esto si el archivo se llama diferente
}

        
        // Configurar eventos para los radio buttons
        document.querySelectorAll('input[name="conversion-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'encode') {
                    document.getElementById('encode-group').style.display = 'block';
                    document.getElementById('decode-group').style.display = 'none';
                } else {
                    document.getElementById('encode-group').style.display = 'none';
                    document.getElementById('decode-group').style.display = 'block';
                }
                // Ocultar el contenedor de resultados al cambiar de opción
                document.getElementById('result').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                // Limpiar los campos de texto
                document.getElementById('text-to-encode').value = '';
                document.getElementById('code-to-decode').value = '';
            });
        });

        // Configurar evento para el botón de conversión
        document.getElementById('convert-btn').addEventListener('click', convertCode);

        // Configurar evento para el botón de copiar
        document.getElementById('copy-btn').addEventListener('click', copyResult);

        // Configurar evento para el botón de cerrar sesión
        document.getElementById('logout-btn').addEventListener('click', function() {
            sessionStorage.removeItem('authenticated');
            window.location.href = 'index.html';
        });

        function convertCode() {
            const conversionType = document.querySelector('input[name="conversion-type"]:checked').value;
            const errorElement = document.getElementById("error");
            const resultElement = document.getElementById("result");
            
            errorElement.style.display = "none";
            resultElement.style.display = "none";
            
            if (conversionType === 'encode') {
                encodeToEmilio();
            } else {
                decodeFromEmilio();
            }
        }

        function encodeToEmilio() {
            const text = document.getElementById("text-to-encode").value.trim().toUpperCase();
            const errorElement = document.getElementById("error");
            const resultElement = document.getElementById("result");
            
            if (!text) {
                showError("Por favor ingrese un texto para codificar");
                return;
            }
            
            let encodedText = '';
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                
                if (char === ' ') {
                    encodedText += ' | ';
                    continue;
                }
                
                if (!/[A-Z]/.test(char)) {
                    encodedText += char;
                    continue;
                }
                
                const position = char.charCodeAt(0) - 64; // A=1, B=2, etc.
                
                // Vocales
                if ('AEIOU'.includes(char)) {
                    switch(char) {
                        case 'A': encodedText += '@6'; break;
                        case 'E': encodedText += '#30'; break;
                        case 'I': encodedText += '$54'; break;
                        case 'O': encodedText += '%84'; break;
                        case 'U': encodedText += '&126'; break;
                    }
                    continue;
                }
                
                // Consonantes
                if (char >= 'B' && char <= 'K') {
                    encodedText += `#${position * 6}`;
                } else if (char >= 'L' && char <= 'T') {
                    encodedText += `$${position * 5}`;
                } else if (char >= 'U' && char <= 'Z') {
                    encodedText += `&${position * 6}`;
                }
            }
            
            document.getElementById("converted-result").textContent = encodedText;
            resultElement.style.display = "block";
        }

        function decodeFromEmilio() {
            const code = document.getElementById("code-to-decode").value.trim();
            const errorElement = document.getElementById("error");
            const resultElement = document.getElementById("result");
            
            if (!code) {
                showError("Por favor ingrese un código para decodificar");
                return;
            }
            
            // Mejoramos la separación de tokens
            const tokenRegex = /([@#$%&]\d+|\|)|./g;
            const tokens = code.match(tokenRegex) || [];
            let decodedText = '';
            
            for (let i = 0; i < tokens.length; i++) {
                const token = tokens[i].trim();
                
                if (token === '|') {
                    decodedText += ' ';
                    continue;
                }
                
                if (token === '') {
                    continue;
                }
                
                // Verificar si es un token válido del código Emilio
                const emilioPattern = /^([@#$%&])(\d+)$/;
                const match = token.match(emilioPattern);
                
                if (match) {
                    const symbol = match[1];
                    const number = parseInt(match[2]);
                    let position;
                    
                    // Determinar la posición según el símbolo
                    if (symbol === '$') {
                        // Grupo 2 (L-T) usa multiplicador 5
                        position = number / 5;
                    } else {
                        // Otros grupos usan multiplicador 6
                        position = number / 6;
                    }
                    
                    // Redondear por si hay decimales
                    position = Math.round(position);
                    
                    // Verificar vocales primero
                    if (symbol === '@' && number === 6) {
                        decodedText += 'A';
                    } else if (symbol === '#' && number === 30) {
                        decodedText += 'E';
                    } else if (symbol === '$' && number === 54) {
                        decodedText += 'I';
                    } else if (symbol === '%' && number === 84) {
                        decodedText += 'O';
                    } else if (symbol === '&' && number === 126) {
                        decodedText += 'U';
                    }
                    // Consonantes
                    else if (position >= 1 && position <= 26) {
                        // Asegurarnos que la posición es válida
                        const letter = String.fromCharCode(64 + position);
                        
                        // Verificar que la letra corresponde al grupo correcto
                        if (symbol === '#' && letter >= 'B' && letter <= 'K') {
                            decodedText += letter;
                        } else if (symbol === '$' && letter >= 'L' && letter <= 'T') {
                            decodedText += letter;
                        } else if (symbol === '&' && letter >= 'U' && letter <= 'Z') {
                            decodedText += letter;
                        } else {
                            // Si no coincide, mantener el token original
                            decodedText += token;
                        }
                    } else {
                        // Posición inválida
                        decodedText += token;
                    }
                } else {
                    // Si no es un token válido, mantenerlo como está
                    decodedText += token;
                }
            }
            
            document.getElementById("converted-result").textContent = decodedText;
            resultElement.style.display = "block";
        }

        function copyResult() {
            const resultText = document.getElementById("converted-result").textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                const copyBtn = document.getElementById("copy-btn");
                copyBtn.textContent = "¡Copiado!";
                setTimeout(() => {
                    copyBtn.textContent = "Copiar resultado";
                }, 2000);
            });
        }

        function showError(message) {
            const errorElement = document.getElementById("error");
            errorElement.textContent = message;
            errorElement.style.display = "block";
        }
// Contador regresivo de 30 minutos
let countdown = 30 * 60;
const timerEl = document.getElementById("timer");

function updateTimer() {
    const minutes = String(Math.floor(countdown / 60)).padStart(2, '0');
    const seconds = String(countdown % 60).padStart(2, '0');
    timerEl.textContent = `${minutes}:${seconds}`;

    if (countdown > 0) {
        countdown--;
    } else {
        sessionStorage.clear();
        window.location.href = 'https://grupoemiliocolor.github.io/mx/index.html';
    }
}

setInterval(updateTimer, 1000);
updateTimer();

// Evento de cerrar sesión manual
document.getElementById('logout-btn').addEventListener('click', function() {
    sessionStorage.removeItem('authenticated');
    window.location.href = 'https://grupoemiliocolor.github.io/mx/index.html';
});


    </script>
</body>
</html>
